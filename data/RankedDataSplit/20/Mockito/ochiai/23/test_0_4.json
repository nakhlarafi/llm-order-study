{
    "bug_id": 23,
    "test_id": 0,
    "test_name": "org.mockitousage.stubbing.DeepStubsSerializableTest.should_serialize_and_deserialize_mock_created_by_deep_stubs",
    "test_body": "public void should_serialize_and_deserialize_mock_created_by_deep_stubs() throws Exception {\n// given\nSampleClass sampleClass = mock(SampleClass.class, withSettings().defaultAnswer(Mockito.RETURNS_DEEP_STUBS).serializable());\nwhen(sampleClass.getSample().isSth()).thenReturn(STUBBED_BOOLEAN_VALUE);\nwhen(sampleClass.getSample().getNumber()).thenReturn(STUBBED_INTEGER_VALUE);\n24: // when\nObject o = SimpleSerializationUtil.serializeAndBack(sampleClass);\n27: // then\nassertThat(o).isInstanceOf(SampleClass.class);\nSampleClass deserializedSample = (SampleClass) o;\nassertThat(deserializedSample.getSample().isSth()).isEqualTo(STUBBED_BOOLEAN_VALUE);\nassertThat(deserializedSample.getSample().getNumber()).isEqualTo(STUBBED_INTEGER_VALUE);\n}\n",
    "stack_trace": "java.io.NotSerializableException: org.mockito.internal.stubbing.defaultanswers.ReturnsDeepStubs$2\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)\nat java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)\nat java.util.concurrent.ConcurrentLinkedQueue.writeObject(ConcurrentLinkedQueue.java:769)\nat sun.reflect.GeneratedMethodAccessor33.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.lang.reflect.Method.invoke(Method.java:498)\nat java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\nat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\nat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\nat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\nat java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)\nat org.mockitoutil.SimpleSerializationUtil.serializeMock(SimpleSerializationUtil.java:34)\nat org.mockitoutil.SimpleSerializationUtil.serializeAndBack(SimpleSerializationUtil.java:16)\nat org.mockitousage.stubbing.DeepStubsSerializableTest.should_serialize_and_deserialize_mock_created_by_deep_stubs(DeepStubsSerializableTest.java:25)",
    "covered_methods": [
        {
            "method_signature": "org.mockito.internal.creation.jmock.ClassImposterizer:imposterise(Lorg/mockito/cglib/proxy/MethodInterceptor;Ljava/lang/Class;Ljava/util/Collection;)Ljava/lang/Object;",
            "method_body": "public <T> T imposterise(final MethodInterceptor interceptor, Class<T> mockedType, Collection<Class> ancillaryTypes) {\nreturn imposterise(interceptor, mockedType, ancillaryTypes.toArray(new Class[ancillaryTypes.size()]));\n}",
            "method_id": 80
        },
        {
            "method_signature": "org.mockito.internal.creation.MethodInterceptorFilter:<init>(Lorg/mockito/internal/InternalMockHandler;Lorg/mockito/mock/MockCreationSettings;)V",
            "method_body": "public MethodInterceptorFilter(InternalMockHandler handler, MockCreationSettings mockSettings) {\nthis.handler = handler;\nthis.mockSettings = mockSettings;\n}",
            "method_id": 81
        },
        {
            "method_signature": "org.mockito.internal.creation.MockSettingsImpl:getSpiedInstance()Ljava/lang/Object;",
            "method_body": "public Object getSpiedInstance() {\nreturn spiedInstance;\n}",
            "method_id": 82
        },
        {
            "method_signature": "org.mockito.internal.MockitoCore:mock(Ljava/lang/Class;Lorg/mockito/MockSettings;)Ljava/lang/Object;",
            "method_body": "public <T> T mock(Class<T> typeToMock, MockSettings settings) {\nif (!MockSettingsImpl.class.isInstance(settings)) {\nMockSettingsImpl impl = MockSettingsImpl.class.cast(settings);\nMockCreationSettings<T> creationSettings = impl.confirm(typeToMock);\nT mock = mockUtil.createMock(creationSettings);\nmockingProgress.mockingStarted(mock, typeToMock);\nreturn mock;\n}",
            "method_id": 83
        },
        {
            "method_signature": "org.mockito.internal.creation.MockSettingsImpl:getExtraInterfaces()Ljava/util/Set;",
            "method_body": "public Set<Class> getExtraInterfaces() {\nreturn extraInterfaces;\n}",
            "method_id": 84
        },
        {
            "method_signature": "org.mockito.internal.creation.MockSettingsImpl:confirm(Ljava/lang/Class;)Lorg/mockito/mock/MockCreationSettings;",
            "method_body": "public MockCreationSettings<T> confirm(Class<T> typeToMock) {\nreturn validatedSettings(typeToMock, this);\n}",
            "method_id": 85
        },
        {
            "method_signature": "org.mockito.internal.creation.MockSettingsImpl:validatedSettings(Ljava/lang/Class;Lorg/mockito/internal/creation/settings/CreationSettings;)Lorg/mockito/internal/creation/settings/CreationSettings;",
            "method_body": "private static <T> CreationSettings<T> validatedSettings(Class<T> typeToMock, CreationSettings<T> source) {\nMockCreationValidator validator = new MockCreationValidator();\nvalidator.validateType(typeToMock);\nvalidator.validateExtraInterfaces(typeToMock, source.getExtraInterfaces());\nvalidator.validateMockedType(typeToMock, source.getSpiedInstance());\nvalidator.validateSerializable(typeToMock, source.isSerializable());\nCreationSettings<T> settings = new CreationSettings<T>(source);\nsettings.setMockName(new MockNameImpl(source.getName(), typeToMock));\nsettings.setTypeToMock(typeToMock);\nsettings.setExtraInterfaces(prepareExtraInterfaces(source));\nreturn settings;\n}",
            "method_id": 86
        },
        {
            "method_signature": "org.mockito.internal.util.MockCreationValidator:validateType(Ljava/lang/Class;)V",
            "method_body": "public void validateType(Class classToMock) {\nif (!mockUtil.isTypeMockable(classToMock)) {\n}",
            "method_id": 87
        },
        {
            "method_signature": "org.mockito.internal.util.MockCreationValidator:validateSerializable(Ljava/lang/Class;Z)V",
            "method_body": "public void validateSerializable(Class classToMock, boolean serializable) {\nif(serializable\n}",
            "method_id": 88
        },
        {
            "method_signature": "org.mockito.internal.util.MockNameImpl:<init>(Ljava/lang/String;Ljava/lang/Class;)V",
            "method_body": "public MockNameImpl(String mockName, Class classToMock) {\nif (mockName == null) {\nthis.mockName = toInstanceName(classToMock);\nthis.defaultName = true;\n}",
            "method_id": 89
        },
        {
            "method_signature": "org.mockito.internal.util.MockCreationValidator:validateExtraInterfaces(Ljava/lang/Class;Ljava/util/Collection;)V",
            "method_body": "public void validateExtraInterfaces(Class classToMock, Collection<Class> extraInterfaces) {\nif (extraInterfaces == null) {\nfor (Class i : extraInterfaces) {\n}",
            "method_id": 90
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.ClassImposterizer:imposterise(Lorg/mockito/cglib/proxy/MethodInterceptor;Ljava/lang/Class;[Ljava/lang/Class;)Ljava/lang/Object;",
            "method_body": "public <T> T imposterise(final MethodInterceptor interceptor, Class<T> mockedType, Class<?>... ancillaryTypes) {\nClass<?> proxyClass = null;\nObject proxyInstance = null;\nsetConstructorsAccessible(mockedType, true);\nproxyClass = createProxyClass(mockedType, ancillaryTypes);\nproxyInstance = createProxy(proxyClass, interceptor);\nreturn mockedType.cast(proxyInstance);\nsetConstructorsAccessible(mockedType, false);\n}",
            "method_id": 91
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.ClassImposterizer:setConstructorsAccessible(Ljava/lang/Class;Z)V",
            "method_body": "public void setConstructorsAccessible(Class<?> mockedType, boolean accessible) {\nfor (Constructor<?> constructor : mockedType.getDeclaredConstructors()) {\nconstructor.setAccessible(accessible);\n}",
            "method_id": 92
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.ClassImposterizer:createProxyClass(Ljava/lang/Class;[Ljava/lang/Class;)Ljava/lang/Class;",
            "method_body": "public Class<?> createProxyClass(Class<?> mockedType, Class<?>... interfaces) {\nif (mockedType == Object.class) {\nEnhancer enhancer = new Enhancer() {\n}\nClass<?>[] allMockedTypes = prepend(mockedType, interfaces);\nenhancer.setClassLoader(SearchingClassLoader.combineLoadersOf(allMockedTypes));\nenhancer.setUseFactory(true);\nif (mockedType.isInterface()) {\nenhancer.setSuperclass(mockedType);\nenhancer.setInterfaces(interfaces);\nenhancer.setCallbackTypes(new Class[]{MethodInterceptor.class, NoOp.class});\nenhancer.setCallbackFilter(IGNORE_BRIDGE_METHODS);\nif (mockedType.getSigners() != null) {\nenhancer.setNamingPolicy(MockitoNamingPolicy.INSTANCE);\nenhancer.setSerialVersionUID(42L);\nreturn enhancer.createClass();\n}",
            "method_id": 93
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.ClassImposterizer:createProxy(Ljava/lang/Class;Lorg/mockito/cglib/proxy/MethodInterceptor;)Ljava/lang/Object;",
            "method_body": "private Object createProxy(Class<?> proxyClass, final MethodInterceptor interceptor) {\nFactory proxy = (Factory) objenesis.newInstance(proxyClass);\nproxy.setCallbacks(new Callback[] {interceptor, SerializableNoOp.SERIALIZABLE_INSTANCE });\nreturn proxy;\n}",
            "method_id": 94
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.ClassImposterizer:prepend(Ljava/lang/Class;[Ljava/lang/Class;)[Ljava/lang/Class;",
            "method_body": "private Class<?>[] prepend(Class<?> first, Class<?>... rest) {\nClass<?>[] all = new Class<?>[rest.length+1];\nall[0] = first;\nSystem.arraycopy(rest, 0, all, 1, rest.length);\nreturn all;\n}",
            "method_id": 95
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.ClassImposterizer$2:accept(Ljava/lang/reflect/Method;)I",
            "method_body": "public int accept(Method method) {\nreturn method.isBridge() ? 1 : 0;\n}",
            "method_id": 96
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.SearchingClassLoader:combineLoadersOf([Ljava/lang/Class;)Ljava/lang/ClassLoader;",
            "method_body": "public static ClassLoader combineLoadersOf(Class<?>... classes) {\nreturn combineLoadersOf(classes[0], classes);\n}",
            "method_id": 97
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.SearchingClassLoader:combineLoadersOf(Ljava/lang/Class;[Ljava/lang/Class;)Ljava/lang/ClassLoader;",
            "method_body": "private static ClassLoader combineLoadersOf(Class<?> first, Class<?>... others) {\nList<ClassLoader> loaders = new ArrayList<ClassLoader>();\naddIfNewElement(loaders, first.getClassLoader());\nfor (Class<?> c : others) {\naddIfNewElement(loaders, c.getClassLoader());\naddIfNewElement(loaders, SearchingClassLoader.class.getClassLoader());\naddIfNewElement(loaders, currentThread().getContextClassLoader());\nreturn combine(loaders);\n}",
            "method_id": 98
        },
        {
            "method_signature": "org.mockito.internal.creation.jmock.SearchingClassLoader:combine(Ljava/util/List;)Ljava/lang/ClassLoader;",
            "method_body": "private static ClassLoader combine(List<ClassLoader> parentLoaders) {\nClassLoader loader = parentLoaders.get(parentLoaders.size()-1);\nfor (int i = parentLoaders.size()-2; i >= 0; i--) {\nreturn loader;\n}",
            "method_id": 99
        }
    ]
}