{
    "bug_id": 66,
    "test_id": 0,
    "test_name": "org.jsoup.nodes.ElementTest.testNextElementSiblingAfterClone",
    "test_body": "1215: public void testNextElementSiblingAfterClone() {\n1216: // via https://github.com/jhy/jsoup/issues/951\n1217: String html = \"<!DOCTYPE html><html lang=\\\"en\\\"><head></head><body><div>Initial element</div></body></html>\";\n1218: String expectedText = \"New element\";\n1219: String cloneExpect = \"New element in clone\";\n1220: 1221: Document original = Jsoup.parse(html);\n1222: Document clone = original.clone();\n1223: 1224: Element originalElement = original.body().child(0);\n1225: originalElement.after(\"<div>\" + expectedText + \"</div>\");\n1226: Element originalNextElementSibling = originalElement.nextElementSibling();\n1227: Element originalNextSibling = (Element) originalElement.nextSibling();\n1228: assertEquals(expectedText, originalNextElementSibling.text());\n1229: assertEquals(expectedText, originalNextSibling.text());\n1230: 1231: Element cloneElement = clone.body().child(0);\n1232: cloneElement.after(\"<div>\" + cloneExpect + \"</div>\");\n1233: Element cloneNextElementSibling = cloneElement.nextElementSibling();\n1234: Element cloneNextSibling = (Element) cloneElement.nextSibling();\n1235: assertEquals(cloneExpect, cloneNextElementSibling.text());\n1236: assertEquals(cloneExpect, cloneNextSibling.text());",
    "stack_trace": "java.lang.NullPointerException\nat org.jsoup.nodes.ElementTest.testNextElementSiblingAfterClone(ElementTest.java:1235)",
    "covered_methods": [
        {
            "method_signature": "org.jsoup.nodes.Element:nextElementSibling()Lorg/jsoup/nodes/Element;",
            "method_body": "public Element nextElementSibling() {\nif (parentNode == null) return null;\nList<Element> siblings = parent().childElementsList();\nInteger index = indexInList(this, siblings);\nValidate.notNull(index);\nif (siblings.size() > index+1)\nreturn siblings.get(index+1);\nreturn null;\n}",
            "method_id": 0
        },
        {
            "method_signature": "org.jsoup.nodes.Node:clone()Lorg/jsoup/nodes/Node;",
            "method_body": "public Node clone() {\nNode thisClone = doClone(null); // splits for orphan\nfinal LinkedList<Node> nodesToProcess = new LinkedList<>();\nnodesToProcess.add(thisClone);\nwhile (!nodesToProcess.isEmpty()) {\nNode currParent = nodesToProcess.remove();\nfinal int size = currParent.childNodeSize();\nfor (int i = 0; i < size; i++) {\nfinal List<Node> childNodes = currParent.ensureChildNodes();\nNode childClone = childNodes.get(i).doClone(currParent);\nchildNodes.set(i, childClone);\nnodesToProcess.add(childClone);\n}\nreturn thisClone;\n}",
            "method_id": 1
        },
        {
            "method_signature": "org.jsoup.nodes.Element:doClone(Lorg/jsoup/nodes/Node;)Lorg/jsoup/nodes/Element;",
            "method_body": "protected Element doClone(Node parent) {\nElement clone = (Element) super.doClone(parent);\nclone.attributes = attributes != null ? attributes.clone() : null;\nclone.baseUri = baseUri;\nclone.childNodes = new NodeList(childNodes.size());\nclone.childNodes.addAll(childNodes);\nreturn clone;\n}",
            "method_id": 2
        },
        {
            "method_signature": "org.jsoup.nodes.Attributes:clone()Lorg/jsoup/nodes/Attributes;",
            "method_body": "public Attributes clone() {\nclone = (Attributes) super.clone();\n}\nclone.size = size;\nkeys = copyOf(keys, size);\nvals = copyOf(vals, size);\nreturn clone;\n}",
            "method_id": 3
        },
        {
            "method_signature": "org.jsoup.nodes.Document:clone()Lorg/jsoup/nodes/Document;",
            "method_body": "public Document clone() {\nDocument clone = (Document) super.clone();\nclone.outputSettings = this.outputSettings.clone();\nreturn clone;\n}",
            "method_id": 4
        },
        {
            "method_signature": "org.jsoup.nodes.Node:addSiblingHtml(ILjava/lang/String;)V",
            "method_body": "private void addSiblingHtml(int index, String html) {\nValidate.notNull(html);\nValidate.notNull(parentNode);\nElement context = parent() instanceof Element ? (Element) parent() : null;\nList<Node> nodes = Parser.parseFragment(html, context, baseUri());\nparentNode.addChildren(index, nodes.toArray(new Node[nodes.size()]));\n}",
            "method_id": 5
        },
        {
            "method_signature": "org.jsoup.nodes.Node:doClone(Lorg/jsoup/nodes/Node;)Lorg/jsoup/nodes/Node;",
            "method_body": "protected Node doClone(Node parent) {\nclone = (Node) super.clone();\n}\nclone.parentNode = parent; // can be null, to create an orphan split\nclone.siblingIndex = parent == null ? 0 : siblingIndex;\nreturn clone;\n}",
            "method_id": 6
        },
        {
            "method_signature": "org.jsoup.nodes.Document$OutputSettings:clone()Lorg/jsoup/nodes/Document$OutputSettings;",
            "method_body": "public OutputSettings clone() {\nclone = (OutputSettings) super.clone();\n}\nclone.charset(charset.name()); // new charset and charset encoder\nclone.escapeMode = Entities.EscapeMode.valueOf(escapeMode.name());\nreturn clone;\n}",
            "method_id": 7
        },
        {
            "method_signature": "org.jsoup.nodes.Node:after(Ljava/lang/String;)Lorg/jsoup/nodes/Node;",
            "method_body": "public Node after(String html) {\naddSiblingHtml(siblingIndex + 1, html);\nreturn this;\n}",
            "method_id": 8
        },
        {
            "method_signature": "org.jsoup.nodes.Element:after(Ljava/lang/String;)Lorg/jsoup/nodes/Element;",
            "method_body": "public Element after(String html) {\nreturn (Element) super.after(html);\n}",
            "method_id": 9
        },
        {
            "method_signature": "org.jsoup.nodes.Element:clone()Lorg/jsoup/nodes/Element;",
            "method_body": "public Element clone() {\nreturn (Element) super.clone();\n}",
            "method_id": 10
        },
        {
            "method_signature": "org.jsoup.nodes.Node:nextSibling()Lorg/jsoup/nodes/Node;",
            "method_body": "public Node nextSibling() {\nif (parentNode == null)\nfinal List<Node> siblings = parentNode.ensureChildNodes();\nfinal int index = siblingIndex+1;\nif (siblings.size() > index)\nreturn siblings.get(index);\nreturn null;\n}",
            "method_id": 11
        },
        {
            "method_signature": "org.jsoup.nodes.Element:parents()Lorg/jsoup/select/Elements;",
            "method_body": "public Elements parents() {\nElements parents = new Elements();\naccumulateParents(this, parents);\nreturn parents;\n}",
            "method_id": 12
        },
        {
            "method_signature": "org.jsoup.nodes.Element:accumulateParents(Lorg/jsoup/nodes/Element;Lorg/jsoup/select/Elements;)V",
            "method_body": "private static void accumulateParents(Element el, Elements parents) {\nElement parent = el.parent();\nif (parent != null && !parent.tagName().equals(\"#root\")) {\nparents.add(parent);\naccumulateParents(parent, parents);\n}",
            "method_id": 13
        },
        {
            "method_signature": "org.jsoup.nodes.Element:text()Ljava/lang/String;",
            "method_body": "public String text() {\nfinal StringBuilder accum = new StringBuilder();\nNodeTraversor.traverse(new NodeVisitor() {\nif (node instanceof TextNode) {\nTextNode textNode = (TextNode) node;\nappendNormalisedText(accum, textNode);\n} else if (node instanceof Element) {\nElement element = (Element) node;\nif (accum.length() > 0 &&\n}\n}\nreturn accum.toString().trim();\n}",
            "method_id": 14
        },
        {
            "method_signature": "org.jsoup.nodes.Element:<init>(Lorg/jsoup/parser/Tag;Ljava/lang/String;Lorg/jsoup/nodes/Attributes;)V",
            "method_body": "public Element(Tag tag, String baseUri, Attributes attributes) {\nValidate.notNull(tag);\nValidate.notNull(baseUri);\nchildNodes = EMPTY_NODES;\nthis.baseUri = baseUri;\nthis.attributes = attributes;\nthis.tag = tag;\n}",
            "method_id": 15
        },
        {
            "method_signature": "org.jsoup.nodes.Element:childElementsList()Ljava/util/List;",
            "method_body": "private List<Element> childElementsList() {\nif (shadowChildrenRef == null || (children = shadowChildrenRef.get()) == null) {\nfinal int size = childNodes.size();\nchildren = new ArrayList<>(size);\nfor (int i = 0; i < size; i++) {\nfinal Node node = childNodes.get(i);\nif (node instanceof Element)\nchildren.add((Element) node);\nshadowChildrenRef = new WeakReference<>(children);\nreturn children;\n}",
            "method_id": 16
        },
        {
            "method_signature": "org.jsoup.nodes.Element:<init>(Lorg/jsoup/parser/Tag;Ljava/lang/String;)V",
            "method_body": "public Element(Tag tag, String baseUri) {\nthis(tag, baseUri, null);\n}",
            "method_id": 17
        },
        {
            "method_signature": "org.jsoup.nodes.Element:child(I)Lorg/jsoup/nodes/Element;",
            "method_body": "public Element child(int index) {\nreturn childElementsList().get(index);\n}",
            "method_id": 18
        },
        {
            "method_signature": "org.jsoup.nodes.Element:<clinit>()V",
            "method_body": "private static final List<Node> EMPTY_NODES = Collections.emptyList();\nprivate static final Pattern classSplit = Pattern.compile(\"\\\\s+\");\n}",
            "method_id": 19
        }
    ]
}